# Contributing to Brain Networks in Python project

Welcome to the Brain Networks in Python GitHub repository, and thank you for thinking about contributing! :smiley::heart::smiley:

The point of this file is to make it suuuuuper easy for you to get involved. So if you have any questions that aren't covered here please let us know! Check out the [Share your thoughts](#share-your-thoughts) section below for more details.

Before you start you'll need to set up a free [GitHub][link_github] account and sign in. Here are some [instructions][link_signupinstructions].

Scroll down or jump to one of the following sections:

* [Share your thoughts](#share-your-thoughts)
  * [A description of the different labels](#labels)
* [Make a change](#make-a-change)
* [Recognising contributions](#recognising-contributions)
* [Get in touch](#how-to-get-in-touch)
* [Development Guide](#development-guide)

## Share your thoughts

Although GitHub calls them **issues**, we'd like you to think of them as **conversation starters**. They're our way of communicating across all the members of the team.

(If you're here you ***already are*** a member of the Brain Networks in Python team.)

Your thoughts can be [questions][link_question], [bugs][link_bug], [requests][link_request], or a myriad of other suggestions. In the next section we'll talk through some of the labels on each issue to help you select the ones you'd most like to help with.

GitHub has a nice set of help pages if you're looking for more information about [discussing projects in issues][link_discussingissues].

### Labels

You can find all currently open conversations under the [issues tab][link_issues].

The current list of labels are [here][link_labels] and include:

* [![question](https://img.shields.io/badge/-question-cc317c.svg)][link_question] These issues are questions and represent a great place to start. Whomever has opened the issue wants to hear from you!

    To reply, read the question and then respond in a variety of different ways:

    * If you want to just agree with everything you can [react to the post][link_react] with one of :+1: :laugh: :heart: :tada:
    * Alternatively you could write a comment to:
      * express your emotions more dramatically (check out this [cheat sheet][link_emojis] for emojis you might need)
      * provide a more nuanced description of your answer (using your words)
      * ask for a clarification
      * ask a follow up question

<br>

* [![no-code](https://img.shields.io/badge/-no--code-207de5.svg)][link_nocode] These issues don't require any coding knowledge.

    If you're looking to contribute but aren't very confident in your coding skills these issues are a great place to start.

    All issues with the no code label are suggesting documentation tasks, or asking for feedback or suggestions.

<br>

* [![good-first-bug](https://img.shields.io/badge/-good--first--bug-5319e7.svg)][link_goodfirstbug] These issues contain a task that anyone with any level of experience can help with.

    A major goal of the project is to have as many people as possible complete their very first [pull request][link_pullrequest] on one of these issues. They will always have explicit information on who to contact to help you through the process.

    Remember: **There are no stupid questions!**

    We can not encourage you enough to submit even the tiniest change to the project repository. Let's go from :confused: & :anguished: to :smiley: & :tada: together!

<br>

* [![help-wanted](https://img.shields.io/badge/-help--wanted-159818.svg)][link_helpwanted] These issues contain a task that a member of the team has determined we need additional help with.

    If you have particular skills then consider reading through these issues as they are a great place to offer your expertise.

    If you aren't sure what to offer, you could also recommend issues to your friends/colleagues who may be able to help.

<br>

* [![bug](https://img.shields.io/badge/-bug-fc2929.svg)][link_bug] These issues point to problems in the project.

    If you find a bug, please give as much detail as possible in your issue.

    If you experience the same bug as one already listed, please add any additional information that you have as a comment.

<br>

* [![request](https://img.shields.io/badge/-request-fbca04.svg)][link_request] These issues are asking for features (or anything else) to be added to the project.

    If you have a good idea and would like to see it implemented in the Brain Networks in Python project please open a new issue and add in as much detail as possible.

    Please try to make sure that your feature is distinct from any others that have already been requested or implemented. If you find one that's similar but there are subtle differences please reference the other request in your issue.


## Make a change

Once you've identified one of the issues above that you feel you can contribute to, you're ready to make a change to the project repository! :tada::smiley:

1. First, describe what you're planning to do as a comment to the issue, (and this might mean making a new issue).

    Check in with one of the Brain Networks in Python development team to ensure you aren't overlapping with work that's currently underway and that everyone is on the same page with the goal of the work you're going to carry out.

    [This blog][link_pushpullblog] is a nice explanation of why putting this work in up front is so useful to everyone involved.

2. [Fork][link_fork] the [Brain Networks in Python][link_brainnetworksrepo] to your profile.

    You can now do whatever you want with this copy of the project. You won't mess up anyone else's work so you're super safe.

    Make sure to [keep your fork up to date][link_updateupstreamwiki] with the master repository.

3. Make the changes you've discussed.

    Try to keep the changes focused rather than changing lots of things at once. If you feel tempted to branch out then please *literally* branch out: create [separate branches][link_branches] for different updates to make the next step much easier!

4. Submit a [pull request][link_pullrequest].

    A member of the executive team will review your changes, have a bit of discussion and hopefully merge them in!  
    N.B. you don't have to be ready to merge to make a pull request! We encourage you to submit a pull request as early as you want to. They help us to keep track of progress and help you to get earlier feedback.

**Success!!** :balloon::balloon::balloon: Well done! And thank you :smiley::tada::sparkles:


## Recognising contributions

If you're logged into GitHub you can see everyone who has contributed to the repository via our [live contributors page][link_contributorslive]. (You might have to add `WhitakerLab/scona` as the repository name before you click to sign in via GitHub.)

These pages are powered by the [Let's all build a hat rack][link_hatrackhome] project, and we love them.

Quoting from their [website][link_hatrackhome]:

> Open Source project contribution focuses a lot on the code committed to projects, but there is so much more that goes on behind the scenes that is just as valuable to FOSS than the code itself.
>
> LABHR seeks to find those that provide these non-code contributions, and thank them.
>
> LABHR started as an [idea by Leslie Hawthorn][link_hatrackidea]. She advocates openly thanking people on social media, and writing recommendations.
>
> This idea was extended by Katie McLaughlin with her work on [automating this process on GitHub][link_hatrackcontributions].

## How to get in touch

If you have a question or a comment we'd love for you to [open an issue][link_issues] because that will be our fastest way of communicating, getting the answers to you and (if necessary) making a change.

If you'd prefer email, you can contact [Isla](https://github.com/Islast) at [istaden@turing.ac.uk](mailto:istaden@turing.ac.uk). If she doesn't reply to your email after a couple of days please feel free to ping her again.

## Thank you!

You are awesome. :heart_eyes::sparkles::sunny:

And if you've found typos in this (or any other) page, you could consider submitting your very first pull request to fix them via the [typos and broken links][link_fixingtyposissue] issue!

[link_github]: https://github.com/
[link_brainnetworksrepo]: https://github.com/WhitakerLab/scona
[link_signupinstructions]: https://help.github.com/articles/signing-up-for-a-new-github-account
[link_react]: https://github.com/blog/2119-add-reactions-to-pull-requests-issues-and-comments
[link_issues]: https://github.com/WhitakerLab/scona/issues
[link_labels]: https://github.com/WhitakerLab/scona/labels
[link_discussingissues]: https://help.github.com/articles/discussing-projects-in-issues-and-pull-requests
[link_bug]: https://github.com/WhitakerLab/scona/labels/bug
[link_goodfirstbug]: https://github.com/WhitakerLab/scona/labels/good-first-bug
[link_helpwanted]: https://github.com/WhitakerLab/scona/labels/help-wanted
[link_nocode]: https://github.com/WhitakerLab/scona/labels/no-code
[link_question]: https://github.com/WhitakerLab/scona/labels/question
[link_request]: https://github.com/WhitakerLab/scona/labels/request

[link_emojis]: http://www.emoji-cheat-sheet.com/
[link_pullrequest]: https://help.github.com/articles/proposing-changes-to-a-project-with-pull-requests/
[link_fork]: https://help.github.com/articles/fork-a-repo/
[link_pushpullblog]: https://www.igvita.com/2011/12/19/dont-push-your-pull-requests/
[link_branches]: https://help.github.com/articles/creating-and-deleting-branches-within-your-repository/
[link_updateupstreamwiki]: https://github.com/KirstieJane/STEMMRoleModels/wiki/Syncing-your-fork-to-the-original-repository-via-the-browser
[link_contributorslive]: https://labhr.github.io/hatrack/#repo=WhitakerLab/scona
[link_hatrackhome]: https://labhr.github.io/
[link_hatrackidea]: http://hawthornlandings.org/2015/02/13/a-place-to-hang-your-hat/
[link_hatrackcontributions]: http://opensource.com/life/15/10/octohat-github-non-code-contribution-tracker
[link_fixingtyposissue]: https://github.com/WhitakerLab/scona//issues/4



# Development Guide

The contributing guidelines above have dealt with getting involved, asking questions, making pull requests, etcetera. The [development guide](#development-guide) deals with the specifics of contributing code to the scona codebase, and ends with a worked example to guide you through the process of writing docstrings and tests for new sections of code.

* [Installing](#installing-in-editable-mode)
* [Linting](#linting)
* [Docstrings](#writing-docstrings)
* [Building Sphinx docs](#building-sphinx-docs)
* [Tutorials](#tutorials)
* [Testing](#testing)
* [A worked example](#worked-example)


### Installing in editable mode

Use `pip install -e git+https://github.com/WhitakerLab/scona.git` to install scona in editable mode. This means that the python install of scona will be kept up to date with any changes you make, including switching branches in git.

### Linting

scona uses the [PEP8 style guide](https://www.python.org/dev/peps/pep-0008/). You can use [flake8](http://flake8.pycqa.org/en/latest/) to lint code.  
We're quite a young project (at time of writing! August 2018) and so we aren't going to be super hardcore about your linting! Linting should make your life easier, but if you're not sure how to get started, or if this is a barrier to you contributing to scona then don't worry about it or [get in touch](#how-to-get-in-touch) and we'll be happy to help you.  

### Writing docstrings

We at scona love love LOVE documentation 😍 💖 😘 so any contributions that make using the various functions, classes and wrappers easier are ALWAYS welcome.

`scona` uses the `sphinx` extension [`napoleon`](http://www.sphinx-doc.org/en/master/usage/extensions/napoleon.html) to generate code from numpy style docstrings. See the [numpydoc guide](https://numpydoc.readthedocs.io/en/latest/) for details on syntax. 
For an example of how docstrings are written in scona, checkout the [docstrings section](#step-1-docstrings) in our [code example](#worked-example) below.

`sphinx` can automatically create links to crossreference other packages. If set up correctly ``:class:`package-name.special-class` `` renders as `package-name.special-class` with a link to the `special-class` documentation in `package-name`'s online documentation. If the package is scona, the package name can be omitted, so that
``:class:`networkx.Graph` `` becomes [`networkx.Graph`](https://networkx.github.io/documentation/stable/reference/classes/graph.html#networkx.Graph), and ``:func:`create_corrmat` `` becomes [`create_corrmat`](https://whitakerlab.github.io/scona/build/html/scona.html#scona.make_corr_matrices.create_corrmat).  

Crossreferencing is currently set up for the python standard library, networkx, pandas, numpy and python-louvain. It is possible to set this up for other python packages by adding
```python
    'package-name': ('https://package.documentation.url/', None)
```
to the `intersphinx_mapping` dictionary in [docs/source/conf.py](docs/source/conf.py) (the handy dandy configuration file for sphinx).

### Building Sphinx docs

When [docstrings](https://en.wikipedia.org/wiki/Docstring#Python) are updated, `sphinx` can automatically update the docs (and ultimately our website). Unfortunately this is [not yet an automated process](https://github.com/WhitakerLab/scona/issues/79). For the time being somebody needs to build those pages. If you're comfortable doing this you can follow the instructions below, but if it's going to be a barrier to you submitting a pull request then please just prepare the docstrings and the maintainers of scona will build the html files for you 😃. 
You might also use these instructions to build documenatation locally while you're still writing, for example to check rendering.

You will need `sphinx` (`pip install sphinx`) and `make` (depends on your distribution) installed.  
In a terminal, navigate to the docs folder and run `make html`. You should be able to view the new documentation in your browser at `file:///local/path/to/scona/docs/build/html/scona.html#module-scona`

### Tutorials

You may also want to show off the functionality of some new (or old) code. Please feel free to add a tutorial to the tutorials folder. You may find it helpful to use the `NSPN_WhitakerVertes_PNAS2016` data as an example dataset, as demonstrated in [tutorials/tutorial.ipynb](#tutorials/tutorial.ipynb).

### Testing

Tests don't need to be exhaustive or prove the validity of a function. The aim is only to alert us when something has gone wrong. Testing is something most people do naturally whenever they write code. If you think about the sorts of things you would try running in a command line or jupyter notebook to test out a function you have just defined, these are the sorts of things that can go in unit tests.

scona uses pytest to run our test suite. pytest runs test discovery on all modules with names ending `_test.py`, so if you make a new test module, make sure the filename conforms to this format.
Use [`py.test`](https://docs.pytest.org/en/latest) to run tests, or `py.test --cov=scona` if you also want a test coverage report.

For an example of how tests are written in scona, checkout the [testing section](#step-2-testing) in our [code example](#worked-example) below.

### Random seeds

Sometimes you want a random process to choose the same pseudo-random numbers each time so that the process returns the same result each time. This is particularly useful for testing and reproducibility. To do this we set a [random seed](https://www.tutorialspoint.com/python/number_seed.htm).  

There is currently no way to seed the random graph generators in scona except by setting the global seed. For more discussion on this subject see [issue #77](https://github.com/WhitakerLab/scona/issues/77). To set the global random seed put the following lines near the top of your test.

```python
import random
random.seed(42)
```
Where 42 is your integer of choice, see https://docs.python.org/3.7/library/random.html#random.seed


### Worked Example

A lot of the developer guidelines above are a little hard to apply in the abstract, so this section is going to apply them to a sample piece of code. We'll start with a working function and show you how to [add a docstring](#writing-docstrings) and [add some tests](#testing).

We'll start with a new function to calculate the proportion of interhemispheric edges *leaving* each module of a graph. This is a somewhat silly idea given that we have no guarantee that a module is entirely within one hemisphere, but it is only intended for the purpose of demonstration.

```python
def calc_leaving_module_interhem(G, M):
  # Assign a binary variable "interhem" to each edge in G
  # Assign a "hemisphere" label to each node in G
  # N.B this function relies on G having nodal attribute "centroids" defined
  assign_interhem(G)

  leaving_interhem = {}
  # Loop over the modules in M
  for module, nodeset in M.items():
    # Calculate the proportion of edges from a node inside module to a node outside of module that are interhemispheric
    # N.B interhem is a 0, 1 variable indicating if an edges is interhemispheric, so it is possible to sum over the interhem value of valid edges.
    leaving_interhem[module] = np.mean([G.[node1][node2]['interhem'] for node1 in nodeset for node2 in nx.all_neighbors(node1) if node2 not in nodeset])
  return leaving_interhem
```

Now suppose we decide to add this back into the scona source code.

#### step 1: docstrings

The key things to have in the docstring are a short description at the top,
an explanation of the function parameters, and a description of what the
function returns. If, say, the function returns nothing, or has no parameters, you can leave those out. For `calc_leaving_module_interhem` we might write something like this:

```python
def calc_leaving_module_interhem(G, M):
'''
Calculate the proportion of edges leaving each module that are
interhemispheric

Parameters
----------
G : :class:`networkx.Graph`
M : dict
  M maps module names to vertex sets. M represents a nodal
  partition of G

Returns
-------
dict
  a dictionary mapping a module name to the proportion of interhemispheric
  leaving edges

See Also
--------
:func:`assign_interhem`
'''
```

Let's say we add this to [`scona.graph_measures`](scona/graph_measures.py). If you followed the [instructions to build sphinx documentation locally](#building-sphinx-docs) you would be able to view this function in your browser at `file:///local/path/to/scona/docs/build/html/scona.html#module-scona.graph_measures.calc_leaving_module_interhem`

#### step 2: Testing

Now we need to write some tests for this function to [tests/graph_measures_test.py](scona/graph_measures.py)
Tests don't need to be exhaustive or prove the validity of a function. The aim is simply to alert us when something has gone wrong. Testing is something most people do naturally when they write code. If you think about the sorts of sanity checks you would try running in a command line or jupyter notebook to make sure everything is working properly when you have just defined a function, these are the sorts of things that should go in unit tests.

Examples of good tests for `calc_leaving_module_interhem` might be:
* checking that `calc_leaving_module_interhem` raises an error when run on a graph where the nodal attribute "centroids" is not defined.
* checking that `calc_leaving_module_interhem(G, M)` has the same dictionary keys as M for some partition M.
* given a partition M with only two modules, check that the values of `calc_leaving_module_interhem(G, M)` are equal as they are evaluating the same set of edges. (There is no third module to connect to, so the set of leaving A is actually the set of edges from A -> B, which is the same set of edges from B -> A, and these are precisely the edges leaving B)
* given a partition M with only one module, check that the values of `calc_leaving_module_interhem(G, M)` are 0, as there are no leaving edges.

* 
    ```
    G :       0-----1
              |     |
              |     |
              2-----3
    ```
    We can define a simple square graph G with nodes 0 and 2 in the "+1"-hemisphere and 2 and 3 in the "-1"-hemisphere. Using this simple graph let's calculate the expected result for a couple of partitions.
    * If M = `{0: {0,2}, 1: {1,3}}` then `calc_leaving_module_interhem(G, M)` is `{0:1.0, 1:1.0}` since all leaving edges are interhemispheric
    * If M = `{0: {0,1}, 1: {2,3}}` then `calc_leaving_module_interhem(G, M)` is `{0:0.0, 1:0.0}` since no leaving edges are interhemispheric
    * If M = `{0: {0}, 1: {1,2,3}}` then `calc_leaving_module_interhem(G, M)` is `{0:0.5, 1:0.5}`
    These are all sanity checks we can use to check our function is working as expected.


Let's set up a `LeavingModuleInterhem` test case. We use the `setUpClass` method to define some variables which we will use repeatedly throughout.

```python
class LeavingModuleInterhem(unittest.TestCase):
  @classmethod
  def setUpClass(self):
      self.G_no_centroids = nx.erdos_renyi_graph(20, 0.2)
      self.G_random_graph = self.G_no_centroids.copy()
      # assign random centroids to G_random_graph
      scn.assign_node_centroids(
        self.G_random_graph,
        [tuple(np.subtract((.5, .5, .5), np.random.rand(3))) for x in range(20)])
      # Define a trivial partition for G1
      self.M_one_big_module = {0: set(G_random_graph.nodes)}
      # Create a second partition of G1 with two modules
      nodeset1 = set(np.random.choice(self.G_random_graph.nodes))
      nodeset2 = set(self.G_random_graph.nodes).difference(nodeset1)
      self.M_two_random_modules = {0: nodeset1, 1: nodeset2}
      # Create graph G2
      # G2 :      0-----1
      #           |     |
      #           |     |
      #           2-----3
      self.G_square_graph = nx.Graph()
      self.G_square_graph.add_nodes_from([0, 1, 2, 3])
      self.G_square_graph.add_edges_from([(0, 2), (2, 3), (1, 3), (0, 1)])
      scn.assign_node_centroids(
        self.G_square_graph, [(1, 0, 0), (-1, 0, 0), (1, 0, 0), (-1, 0, 0)])
```
Now we have defined the set up for testing, we can move on to the testing methods. These should be short methods making one or two assertions about the behaviour of our new function. We try to make the function names descriptive so that if they error during testing we can tell at a glance which behaviour they were testing.

```python
  def centroids_must_be_defined(self):
    # This function should fail on a graph where no centroids are defined
    with self.assertRaises(Exception):
      scn.calc_leaving_module_interhem(
          self.G_no_centroids, self.M_one_big_module)

  def result_keys_are_modules(self):
    # check that `calc_leaving_module_interhem(G, M)` has the same
    # dictionary keys as M
    result = scn.calc_leaving_module_interhem(
        self.G_random_graph, self.M_one_big_module)
    assert result.keys() == self.M_one_big_module.keys()

  def trivial_partition_values_equal_zero(self):
    # check that the values of `calc_leaving_module_interhem(G, M)` are 0,
    # as there are no leaving edges
    result = scn.calc_leaving_module_interhem(
        self.G_random_graph, self.M_one_big_module)
    for x in result.values():
      assert x == 0

  def partition_size_two_modules_have_equal_values(self):
    # check that the values of `calc_leaving_module_interhem(G, M)` are equal,
    # as they are evaluating the same edges.
    L2 = scn.calc_leaving_module_interhem(
        self.G_random_graph, self.M_two_random_modules)
    assert L2[0] == L2[1]

  def G2_modules_are_hemispheres_values_are_1(self):
    # the leaving interhem values should be one for each module, since since
    # all leaving edges are interhemispheric
    result = scn.calc_leaving_module_interhem(
        self.G_square_graph, {0: {0, 2}, 1: {1, 3}})
    assert result == {0: 1.0, 1: 1.0}

  def G2_modules_are_split_across_hemispheres_values_0(self):
    # the leaving interhem values should be zero for each module, since since
    # none of the leaving edges are interhemispheric
    result = scn.calc_leaving_module_interhem(
        self.G_square_graph, {0: {0, 1}, 1: {2, 3}})
    assert result == {0: 0.0, 1: 0.0}

  def G2_test_module_M5(self):
    result = scn.calc_leaving_module_interhem(
        self.G_square_graph, {0: {0}, 1: {1, 2, 3}})
    assert  == {0: .5, 1: .5}
```

And now you're ready to roll! :tada: 

Thank you for reading this far through scona's contributing guidelines :sparkles::hibiscus::tada:. As always, if you have any question, see any typo's, or have suggestions or corrections for these guidelines don't hesitate to [let us know](#how-to-get-in-touch):heart_eyes:. 
